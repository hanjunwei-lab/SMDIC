#' @importFrom survival survdiff
#' @importFrom survival Surv
#' @importFrom grDevices rgb
#' @export
#' @examples
#' mutcell<-GetExampleData("mutcell") # The result of `mutcorcell` function.
#' cellmatrix<-GetExampleData("cellmatrix") # Cell abundance matrix
#' surv<-GetExampleData("surv") # The survival data
#' survcell(gene ="TP53",mutcell=mutcell,cellmatrix=cellmatrix,surv=surv)
survcell1 <- function(gene,mutcell,cellmatrix,surv,method="Multivariate") {
mutcell<-mutcell$mut_cell
cellgene<-names(which(mutcell[gene,]==1))
colnames(surv)<-c("Samples","Survival","Events")
#surv$Survival<-surv$Survival/30
#surv<-surv[,c(1,3,2)]
cellmatrix.gene<-cellmatrix[cellgene,]
if (method=="Multivariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Multivariate" )
}else if (method=="Univariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Univariate" )
}else {
print("method must be one of 'Univariate'and'Multivariate'.")
}
label<-getCoefExpCluster(coxRes = cox.gene,subprof2 = cellmatrix,subprof = cellmatrix.gene)
#label2<-as.vector(label2[,2])
rownames(label)<-label[,1]
KMdata<-getKMSurAnalyPvalue(subprof2 = cellmatrix,clin2 =surv ,label2 = label)
fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
ggsurvplot(fit2,pval = TRUE)
# P_test
# print(paste("pvalue is ",P_test))
return(label)
}
getKMSurAnalyPvalue<-function(subprof2,clin2,label2){
subprof2<-t(subprof2);#colnames(subprof2)<-paste("gene.",as.character(subprof2[1,]),sep="");subprof2<-subprof2[-1,]
colnames(subprof2)<-paste("gene.",as.character(colnames((subprof2))),sep="");#subprof2<-subprof2[-1,]
samples<-rownames(subprof2);
inter<-intersect(as.character(clin2[,1]),samples)
mm<-match(as.character(inter),as.character(clin2[,1]))
nn<-match(as.character(inter),samples)
newsubprof<-subprof2[nn[which(is.na(nn)==FALSE)],,drop=FALSE];n1<-dim(newsubprof)[2]
clinInfor<-clin2[mm[which(is.na(mm)==FALSE)],];n2<-dim(clinInfor)[2]
KMdata<-data.frame(newsubprof,clinInfor[,-1])[,c((n1+1):(n1+2))]
interT<-intersect(label2[,1],rownames(KMdata))
mm2<-match(as.character(interT),rownames(KMdata))
mm2<-mm2[which(is.na(mm2)==FALSE)]
nn2<-match(as.character(interT),label2[,1])
nn2<-nn2[which(is.na(nn2)==FALSE)]
KMdata<-cbind(label2[nn2,],KMdata[mm2,])[,c(1,3:4,2)]
rownames(KMdata)<-NULL;colnames(KMdata)<-c("Sample","Survival","Events","group")
KMdata[,"Events"]<-as.numeric(KMdata[,"Events"])
####
####write.table(KMdata,"Survival_ClusterInfo.txt",col.names=T,row.names=F,sep="\t",quote=F)
####
#attach(KMdata);
#coefExp<-as.numeric(KMdata[,4])
KMdata[,"group"]<-as.numeric(KMdata[,"group"])-1
KMdata[,"Events"]<-as.numeric(KMdata[,"Events"])+1
KMdata<-as.data.frame(KMdata)
KMdata<-KMdata[,-1]
#save(KMdata,file = "KMdata.rda")
#fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
#fit <- survfit(Surv(time, status) ~ sex, data = lung)
#plot(fit,  mark.time=TRUE,lty = 1,lwd=2,xlab="Survival Time (months)",ylab="Overall Survival",col=c(rgb(31,144,72,maxColorValue=255),rgb(240,24,40,maxColorValue=255)))
#m<-ggsurvplot(fit2,pval = TRUE)
# ggsurvplot(fit,
# pval = TRUE
#, conf.int = TRUE
# risk.table = TRUE, # Add risk table
# risk.table.col = "strata", # Change risk table color by groups
# linetype = "strata", # Change line type by groups
# surv.median.line = "hv", # Specify median survival
# ggtheme = theme_bw(), # Change ggplot2 theme
# palette = c("#E7B800", "#2E9FDF")
# )
# dif<-survdiff(Surv(Survival,as.numeric(Events))~coefExp,data = KMdata)
# dif.pval<-pchisq(dif$chisq,1,lower.tail = F)
# dif.pval<-round(dif.pval,digits=100)
#detach(KMdata);
# return(dif.pval)
return(KMdata)
}
survcell1(gene = "TP53",cellmatrix = cellmatrix_CIBERSORT,surv = surv,mutcell = mutcell_CIBERSORT)
survcell1(gene = "TP53",cellmatrix = cellmatrix,surv = surv,mutcell = mutcell)
detach("package:SMDIC", unload = TRUE)
survcell1(gene = "TP53",cellmatrix = cellmatrix_CIBERSORT,surv = surv,mutcell = mutcell_CIBERSORT)
survcell1(gene = "TP53",cellmatrix = cellmatrix,surv = surv,mutcell = mutcell)
fit3 <- survfit(Surv(Survival, Events) ~ group, data = KMdata)
fit3
ggsurvplot(fit3)
rm
rm(fit1)
rm(fit2)
rm(fit3)
#' @importFrom survival survfit
#' @importFrom survival survdiff
#' @importFrom survival Surv
#' @importFrom grDevices rgb
#' @export
#' @examples
#' mutcell<-GetExampleData("mutcell") # The result of `mutcorcell` function.
#' cellmatrix<-GetExampleData("cellmatrix") # Cell abundance matrix
#' surv<-GetExampleData("surv") # The survival data
#' survcell(gene ="TP53",mutcell=mutcell,cellmatrix=cellmatrix,surv=surv)
survcell1 <- function(gene,mutcell,cellmatrix,surv,method="Multivariate") {
mutcell<-mutcell$mut_cell
cellgene<-names(which(mutcell[gene,]==1))
colnames(surv)<-c("Samples","Survival","Events")
#surv$Survival<-surv$Survival/30
#surv<-surv[,c(1,3,2)]
cellmatrix.gene<-cellmatrix[cellgene,]
if (method=="Multivariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Multivariate" )
}else if (method=="Univariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Univariate" )
}else {
print("method must be one of 'Univariate'and'Multivariate'.")
}
label<-getCoefExpCluster(coxRes = cox.gene,subprof2 = cellmatrix,subprof = cellmatrix.gene)
#label2<-as.vector(label2[,2])
rownames(label)<-label[,1]
KMdata<-getKMSurAnalyPvalue(subprof2 = cellmatrix,clin2 =surv ,label2 = label)
fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
ggsurvplot(fit2,pval = TRUE)
# P_test
# print(paste("pvalue is ",P_test))
return(label)
}
survcell1(gene = "TP53",cellmatrix = cellmatrix,surv = surv,mutcell = mutcell)
#' @importFrom survival survfit
#' @importFrom survival survdiff
#' @importFrom survival Surv
#' @importFrom grDevices rgb
#' @export
#' @examples
#' mutcell<-GetExampleData("mutcell") # The result of `mutcorcell` function.
#' cellmatrix<-GetExampleData("cellmatrix") # Cell abundance matrix
#' surv<-GetExampleData("surv") # The survival data
#' survcell(gene ="TP53",mutcell=mutcell,cellmatrix=cellmatrix,surv=surv)
survcell1 <- function(gene,mutcell,cellmatrix,surv,method="Multivariate") {
mutcell<-mutcell$mut_cell
cellgene<-names(which(mutcell[gene,]==1))
colnames(surv)<-c("Samples","Survival","Events")
#surv$Survival<-surv$Survival/30
#surv<-surv[,c(1,3,2)]
cellmatrix.gene<-cellmatrix[cellgene,]
if (method=="Multivariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Multivariate" )
}else if (method=="Univariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Univariate" )
}else {
print("method must be one of 'Univariate'and'Multivariate'.")
}
label<-getCoefExpCluster(coxRes = cox.gene,subprof2 = cellmatrix,subprof = cellmatrix.gene)
#label2<-as.vector(label2[,2])
rownames(label)<-label[,1]
KMdata<-getKMSurAnalyPvalue(subprof2 = cellmatrix,clin2 =surv ,label2 = label)
print(KMdata)
fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
ggsurvplot(fit2,pval = TRUE)
# P_test
# print(paste("pvalue is ",P_test))
return(label)
}
survcell1(gene = "TP53",cellmatrix = cellmatrix_CIBERSORT,surv = surv,mutcell = mutcell_CIBERSORT)
#' @importFrom survival survfit
#' @importFrom survival survdiff
#' @importFrom survival Surv
#' @importFrom grDevices rgb
#' @export
#' @examples
#' mutcell<-GetExampleData("mutcell") # The result of `mutcorcell` function.
#' cellmatrix<-GetExampleData("cellmatrix") # Cell abundance matrix
#' surv<-GetExampleData("surv") # The survival data
#' survcell(gene ="TP53",mutcell=mutcell,cellmatrix=cellmatrix,surv=surv)
survcell1 <- function(gene,mutcell,cellmatrix,surv,method="Multivariate") {
mutcell<-mutcell$mut_cell
cellgene<-names(which(mutcell[gene,]==1))
colnames(surv)<-c("Samples","Survival","Events")
#surv$Survival<-surv$Survival/30
#surv<-surv[,c(1,3,2)]
cellmatrix.gene<-cellmatrix[cellgene,]
if (method=="Multivariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Multivariate" )
}else if (method=="Univariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Univariate" )
}else {
print("method must be one of 'Univariate'and'Multivariate'.")
}
label<-getCoefExpCluster(coxRes = cox.gene,subprof2 = cellmatrix,subprof = cellmatrix.gene)
#label2<-as.vector(label2[,2])
rownames(label)<-label[,1]
KMdata<-getKMSurAnalyPvalue(subprof2 = cellmatrix,clin2 =surv ,label2 = label)
#print(KMdata)
save(KMdata,file = "KMdata2.rda")
fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
ggsurvplot(fit2,pval = TRUE)
# P_test
# print(paste("pvalue is ",P_test))
return(label)
}
survcell1(gene = "TP53",cellmatrix = cellmatrix_CIBERSORT,surv = surv,mutcell = mutcell_CIBERSORT)
load("D:/SMDIC/KMdata2.rda")
fit3 <- survfit(Surv(Survival, Events) ~ group, data = KMdata)
ggsurvplot(fit3)
library(survival)
#' @importFrom survival survfit
#' @importFrom survival survdiff
#' @importFrom survival Surv
#' @importFrom grDevices rgb
#' @export
#' @examples
#' mutcell<-GetExampleData("mutcell") # The result of `mutcorcell` function.
#' cellmatrix<-GetExampleData("cellmatrix") # Cell abundance matrix
#' surv<-GetExampleData("surv") # The survival data
#' survcell(gene ="TP53",mutcell=mutcell,cellmatrix=cellmatrix,surv=surv)
survcell1 <- function(gene,mutcell,cellmatrix,surv,method="Multivariate") {
mutcell<-mutcell$mut_cell
cellgene<-names(which(mutcell[gene,]==1))
colnames(surv)<-c("Samples","Survival","Events")
#surv$Survival<-surv$Survival/30
#surv<-surv[,c(1,3,2)]
cellmatrix.gene<-cellmatrix[cellgene,]
if (method=="Multivariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Multivariate" )
}else if (method=="Univariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Univariate" )
}else {
print("method must be one of 'Univariate'and'Multivariate'.")
}
label<-getCoefExpCluster(coxRes = cox.gene,subprof2 = cellmatrix,subprof = cellmatrix.gene)
#label2<-as.vector(label2[,2])
rownames(label)<-label[,1]
KMdata<-getKMSurAnalyPvalue(subprof2 = cellmatrix,clin2 =surv ,label2 = label)
#print(KMdata)
save(KMdata,file = "KMdata2.rda")
fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
ggsurvplot(fit2,pval = TRUE)
# P_test
# print(paste("pvalue is ",P_test))
return(label)
}
survcell1(gene = "TP53",cellmatrix = cellmatrix_CIBERSORT,surv = surv,mutcell = mutcell_CIBERSORT)
survplottest <- function(KMdata) {
fit <- survfit(Surv(Survival, Events) ~ group, data = KMdata)
ggsurvplot(fit)
}
survplottest <- function(KMdata) {
fit <- survfit(Surv(Survival, Events) ~ group, data = KMdata)
ggsurvplot(fit,pval = TRUE)
}
survplottest <- function(KMdata) {
fit <- survfit(Surv(Survival, Events) ~ group, data = KMdata)
ggsurvplot(fit,pval = TRUE)
}
survplottest(KMdata = KMdata)
survplot <- function(KMdata) {
fit <- survfit(Surv(Survival, Events) ~ group, data = KMdata)
ggsurvplot(fit,pval = TRUE)
}
rm(KMdata)
#' @importFrom survival survfit
#' @importFrom survival survdiff
#' @importFrom survival Surv
#' @importFrom grDevices rgb
#' @export
#' @examples
#' mutcell<-GetExampleData("mutcell") # The result of `mutcorcell` function.
#' cellmatrix<-GetExampleData("cellmatrix") # Cell abundance matrix
#' surv<-GetExampleData("surv") # The survival data
#' survcell(gene ="TP53",mutcell=mutcell,cellmatrix=cellmatrix,surv=surv)
survcell1 <- function(gene,mutcell,cellmatrix,surv,method="Multivariate") {
mutcell<-mutcell$mut_cell
cellgene<-names(which(mutcell[gene,]==1))
colnames(surv)<-c("Samples","Survival","Events")
#surv$Survival<-surv$Survival/30
#surv<-surv[,c(1,3,2)]
cellmatrix.gene<-cellmatrix[cellgene,]
if (method=="Multivariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Multivariate" )
}else if (method=="Univariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Univariate" )
}else {
print("method must be one of 'Univariate'and'Multivariate'.")
}
label<-getCoefExpCluster(coxRes = cox.gene,subprof2 = cellmatrix,subprof = cellmatrix.gene)
#label2<-as.vector(label2[,2])
rownames(label)<-label[,1]
KMdata<-getKMSurAnalyPvalue(subprof2 = cellmatrix,clin2 =surv ,label2 = label)
#print(KMdata)
# save(KMdata,file = "KMdata2.rda")
# fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
# ggsurvplot(fit2,pval = TRUE)
survplot(KMdata = KMdata)
# P_test
# print(paste("pvalue is ",P_test))
return(label)
}
#' @importFrom survival survfit
#' @importFrom survival survdiff
#' @importFrom survival Surv
#' @importFrom grDevices rgb
#' @export
#' @examples
#' mutcell<-GetExampleData("mutcell") # The result of `mutcorcell` function.
#' cellmatrix<-GetExampleData("cellmatrix") # Cell abundance matrix
#' surv<-GetExampleData("surv") # The survival data
#' survcell(gene ="TP53",mutcell=mutcell,cellmatrix=cellmatrix,surv=surv)
survcell1 <- function(gene,mutcell,cellmatrix,surv,method="Multivariate") {
mutcell<-mutcell$mut_cell
cellgene<-names(which(mutcell[gene,]==1))
colnames(surv)<-c("Samples","Survival","Events")
#surv$Survival<-surv$Survival/30
#surv<-surv[,c(1,3,2)]
cellmatrix.gene<-cellmatrix[cellgene,]
if (method=="Multivariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Multivariate" )
}else if (method=="Univariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Univariate" )
}else {
print("method must be one of 'Univariate'and'Multivariate'.")
}
label<-getCoefExpCluster(coxRes = cox.gene,subprof2 = cellmatrix,subprof = cellmatrix.gene)
#label2<-as.vector(label2[,2])
rownames(label)<-label[,1]
KMdata<-getKMSurAnalyPvalue(subprof2 = cellmatrix,clin2 =surv ,label2 = label)
#print(KMdata)
# save(KMdata,file = "KMdata2.rda")
# fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
# ggsurvplot(fit2,pval = TRUE)
survplot(KMdata = KMdata)
# P_test
# print(paste("pvalue is ",P_test))
#return(label)
}
survplot <- function(KMdata) {
fit <- survfit(Surv(Survival, Events) ~ group, data = KMdata)
ggsurvplot(fit,pval = TRUE)
}
survcell1(gene = "TP53",cellmatrix = cellmatrix_CIBERSORT,surv = surv,mutcell = mutcell_CIBERSORT)
getKMSurAnalyPvalue<-function(subprof2,clin2,label2){
subprof2<-t(subprof2);#colnames(subprof2)<-paste("gene.",as.character(subprof2[1,]),sep="");subprof2<-subprof2[-1,]
colnames(subprof2)<-paste("gene.",as.character(colnames((subprof2))),sep="");#subprof2<-subprof2[-1,]
samples<-rownames(subprof2);
inter<-intersect(as.character(clin2[,1]),samples)
mm<-match(as.character(inter),as.character(clin2[,1]))
nn<-match(as.character(inter),samples)
newsubprof<-subprof2[nn[which(is.na(nn)==FALSE)],,drop=FALSE];n1<-dim(newsubprof)[2]
clinInfor<-clin2[mm[which(is.na(mm)==FALSE)],];n2<-dim(clinInfor)[2]
KMdata<-data.frame(newsubprof,clinInfor[,-1])[,c((n1+1):(n1+2))]
interT<-intersect(label2[,1],rownames(KMdata))
mm2<-match(as.character(interT),rownames(KMdata))
mm2<-mm2[which(is.na(mm2)==FALSE)]
nn2<-match(as.character(interT),label2[,1])
nn2<-nn2[which(is.na(nn2)==FALSE)]
KMdata<-cbind(label2[nn2,],KMdata[mm2,])[,c(1,3:4,2)]
rownames(KMdata)<-NULL;colnames(KMdata)<-c("Sample","Survival","Events","group")
KMdata[,"Events"]<-as.numeric(KMdata[,"Events"])
####
####write.table(KMdata,"Survival_ClusterInfo.txt",col.names=T,row.names=F,sep="\t",quote=F)
####
#attach(KMdata);
#coefExp<-as.numeric(KMdata[,4])
KMdata[,"group"]<-as.numeric(KMdata[,"group"])-1
KMdata[,"Events"]<-as.numeric(KMdata[,"Events"])+1
KMdata<-as.data.frame(KMdata)
KMdata<-KMdata[,-1]
#save(KMdata,file = "KMdata.rda")
#fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
#fit <- survfit(Surv(time, status) ~ sex, data = lung)
#plot(fit,  mark.time=TRUE,lty = 1,lwd=2,xlab="Survival Time (months)",ylab="Overall Survival",col=c(rgb(31,144,72,maxColorValue=255),rgb(240,24,40,maxColorValue=255)))
#m<-ggsurvplot(fit2,pval = TRUE)
# ggsurvplot(fit,
# pval = TRUE
#, conf.int = TRUE
# risk.table = TRUE, # Add risk table
# risk.table.col = "strata", # Change risk table color by groups
# linetype = "strata", # Change line type by groups
# surv.median.line = "hv", # Specify median survival
# ggtheme = theme_bw(), # Change ggplot2 theme
# palette = c("#E7B800", "#2E9FDF")
# )
# dif<-survdiff(Surv(Survival,as.numeric(Events))~coefExp,data = KMdata)
# dif.pval<-pchisq(dif$chisq,1,lower.tail = F)
# dif.pval<-round(dif.pval,digits=100)
#detach(KMdata);
# return(dif.pval)
return(KMdata)
}
#' @importFrom survival survfit
#' @importFrom survival survdiff
#' @importFrom survival Surv
#' @importFrom grDevices rgb
#' @export
#' @examples
#' mutcell<-GetExampleData("mutcell") # The result of `mutcorcell` function.
#' cellmatrix<-GetExampleData("cellmatrix") # Cell abundance matrix
#' surv<-GetExampleData("surv") # The survival data
#' survcell(gene ="TP53",mutcell=mutcell,cellmatrix=cellmatrix,surv=surv)
survcell1 <- function(gene,mutcell,cellmatrix,surv,method="Multivariate") {
mutcell<-mutcell$mut_cell
cellgene<-names(which(mutcell[gene,]==1))
colnames(surv)<-c("Samples","Survival","Events")
#surv$Survival<-surv$Survival/30
#surv<-surv[,c(1,3,2)]
cellmatrix.gene<-cellmatrix[cellgene,]
if (method=="Multivariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Multivariate" )
}else if (method=="Univariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Univariate" )
}else {
print("method must be one of 'Univariate'and'Multivariate'.")
}
label<-getCoefExpCluster(coxRes = cox.gene,subprof2 = cellmatrix,subprof = cellmatrix.gene)
#label2<-as.vector(label2[,2])
rownames(label)<-label[,1]
KMdata<-getKMSurAnalyPvalue(subprof2 = cellmatrix,clin2 =surv ,label2 = label)
#print(KMdata)
# save(KMdata,file = "KMdata2.rda")
# fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
# ggsurvplot(fit2,pval = TRUE)
survplot(KMdata = KMdata)
# P_test
# print(paste("pvalue is ",P_test))
#return(label)
}
#' @importFrom survival survfit
#' @importFrom survival survdiff
#' @importFrom survival Surv
#' @importFrom grDevices rgb
#' @export
#' @examples
#' mutcell<-GetExampleData("mutcell") # The result of `mutcorcell` function.
#' cellmatrix<-GetExampleData("cellmatrix") # Cell abundance matrix
#' surv<-GetExampleData("surv") # The survival data
#' survcell(gene ="TP53",mutcell=mutcell,cellmatrix=cellmatrix,surv=surv)
survcell1 <- function(gene,mutcell,cellmatrix,surv,method="Multivariate") {
mutcell<-mutcell$mut_cell
cellgene<-names(which(mutcell[gene,]==1))
colnames(surv)<-c("Samples","Survival","Events")
#surv$Survival<-surv$Survival/30
#surv<-surv[,c(1,3,2)]
cellmatrix.gene<-cellmatrix[cellgene,]
if (method=="Multivariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Multivariate" )
}else if (method=="Univariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Univariate" )
}else {
print("method must be one of 'Univariate'and'Multivariate'.")
}
label<-getCoefExpCluster(coxRes = cox.gene,subprof2 = cellmatrix,subprof = cellmatrix.gene)
#label2<-as.vector(label2[,2])
rownames(label)<-label[,1]
KMdata<-getKMSurAnalyPvalue(subprof2 = cellmatrix,clin2 =surv ,label2 = label)
print("hahah")
#print(KMdata)
# save(KMdata,file = "KMdata2.rda")
# fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
# ggsurvplot(fit2,pval = TRUE)
survplot(KMdata = KMdata)
# P_test
# print(paste("pvalue is ",P_test))
#return(label)
}
survcell1(gene = "TP53",cellmatrix = cellmatrix_CIBERSORT,surv = surv,mutcell = mutcell_CIBERSORT)
library(survminer)
load("D:/SMDIC/KMdata2.rda")
#print("hahah")
#print(KMdata)
# save(KMdata,file = "KMdata2.rda")
# fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
# ggsurvplot(fit2,pval = TRUE)
survplot(KMdata = KMdata)
#' @importFrom survival survfit
#' @importFrom survival survdiff
#' @importFrom survival Surv
#' @importFrom grDevices rgb
#' @export
#' @examples
#' mutcell<-GetExampleData("mutcell") # The result of `mutcorcell` function.
#' cellmatrix<-GetExampleData("cellmatrix") # Cell abundance matrix
#' surv<-GetExampleData("surv") # The survival data
#' survcell(gene ="TP53",mutcell=mutcell,cellmatrix=cellmatrix,surv=surv)
survcell1 <- function(gene,mutcell,cellmatrix,surv,method="Multivariate") {
mutcell<-mutcell$mut_cell
cellgene<-names(which(mutcell[gene,]==1))
colnames(surv)<-c("Samples","Survival","Events")
#surv$Survival<-surv$Survival/30
#surv<-surv[,c(1,3,2)]
cellmatrix.gene<-cellmatrix[cellgene,]
if (method=="Multivariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Multivariate" )
}else if (method=="Univariate") {
cox.gene<-getUniOrMultiCOXAnalysis(subprof = cellmatrix.gene,clin = surv,method ="Univariate" )
}else {
print("method must be one of 'Univariate'and'Multivariate'.")
}
label<-getCoefExpCluster(coxRes = cox.gene,subprof2 = cellmatrix,subprof = cellmatrix.gene)
#label2<-as.vector(label2[,2])
rownames(label)<-label[,1]
survplot(getKMSurAnalyPvalue(subprof2 = cellmatrix,clin2 =surv ,label2 = label))
#print("hahah")
#print(KMdata)
# save(KMdata,file = "KMdata2.rda")
# fit2<-survfit(Surv(Survival,Events) ~ group,data = KMdata)
# ggsurvplot(fit2,pval = TRUE)
(KMdata)
# P_test
# print(paste("pvalue is ",P_test))
#return(label)
}
survcell1(gene = "TP53",cellmatrix = cellmatrix,surv = surv,mutcell = mutcell)
